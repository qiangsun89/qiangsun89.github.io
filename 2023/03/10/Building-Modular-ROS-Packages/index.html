

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Qiang Sun">
  <meta name="keywords" content="">
  
    <meta name="description" content="Building Modular ROS PackagesIntroduction&amp;emsp;The key power of the Catkin build tool is how it makes it easier to build modular software without having to keep track of the specific build products of">
<meta property="og:type" content="article">
<meta property="og:title" content="Building Modular ROS Packages">
<meta property="og:url" content="https://qiangsun89.github.io/2023/03/10/Building-Modular-ROS-Packages/index.html">
<meta property="og:site_name" content="知识的搬运工">
<meta property="og:description" content="Building Modular ROS PackagesIntroduction&amp;emsp;The key power of the Catkin build tool is how it makes it easier to build modular software without having to keep track of the specific build products of">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2023-03-10T05:59:03.000Z">
<meta property="article:modified_time" content="2023-03-10T06:31:18.711Z">
<meta property="article:author" content="Qiang Sun">
<meta property="article:tag" content="转载">
<meta name="twitter:card" content="summary_large_image">
  
  
  
  <title>Building Modular ROS Packages - 知识的搬运工</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"qiangsun89.github.io","root":"/","version":"1.9.4","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"LEYjQzDk7jo8uqlOQoAEF5qm-gzGzoHsz","app_key":"7bBCyINnLw0akaPjI39pESMN","server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  

  

  

  

  

  
    
  



  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>小强的学习笔记</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Building Modular ROS Packages"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-03-10 13:59" pubdate>
          2023年3月10日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          19k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          155 分钟
        
      </span>
    

    
    
      
        <span id="leancloud-page-views-container" class="post-meta" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="leancloud-page-views"></span> 次
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">Building Modular ROS Packages</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="Building-Modular-ROS-Packages"><a href="#Building-Modular-ROS-Packages" class="headerlink" title="Building Modular ROS Packages"></a>Building Modular ROS Packages</h1><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>&emsp;The key power of the Catkin build tool is how it makes it easier to build modular software without having to keep track of the specific build products of each package. Modularity, in this case, comes in the form of building specific functionality into libraries which can be used by other packages. This tutorial is meant for someone with minimal to moderate CMake experience and minimal experience with Catkin.</p>
<p>&emsp;This tutorial begins by separating the executable code from the ROS C++ Hello World Tutorial into a library and building it with CMake and Catkin. If you are unfamilar with Catkin or CMake, this tutorial will make more sense after you have worked through the Gentle Introduction to Catkin.</p>
<p>&emsp;The next step involves creating a second package which depends on the first package and uses the functionality defined in our library. This inter-dependency then demonstrates how to use the <font color=red>catkin_package()</font> CMake function to declare exported targets for a package.</p>
<h2 id="Pre-Requisites"><a href="#Pre-Requisites" class="headerlink" title="Pre-Requisites"></a>Pre-Requisites</h2><ul>
<li>A computer running a recent Ubuntu Linix1 LTS (long-term support) installation</li>
<li>Minimal experience with the Linux and the command-line interface</li>
<li>Minimal experience with compiling C++ code</li>
</ul>
<h2 id="Tools-Used"><a href="#Tools-Used" class="headerlink" title="Tools Used"></a>Tools Used</h2><ul>
<li>Ubuntu Linux</li>
<li>The bash shell</li>
<li>C++</li>
<li>CMake</li>
<li>Catkin</li>
<li>Any plain-text editor (I like vim).</li>
</ul>
<h2 id="ROS-Packages-Used"><a href="#ROS-Packages-Used" class="headerlink" title="ROS Packages Used"></a>ROS Packages Used</h2><ul>
<li>roscpp</li>
<li>roscpp</li>
<li>catkin</li>
</ul>
<h2 id="Create-a-Catkin-Package"><a href="#Create-a-Catkin-Package" class="headerlink" title="Create a Catkin Package"></a>Create a Catkin Package</h2><p>Create a new directory for your package:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> src/modular_lib_pkg<br></code></pre></td></tr></table></figure><br>Add bare-bones Catkin CMakeLists.txt and package.xml files to make your directory a valid package:<br>src/modular_lib_pkg/CMakeLists.txt<br><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs cmake"><span class="hljs-comment"># Declare the version of the CMake API for forward-compatibility</span><br><span class="hljs-keyword">cmake_minimum_required</span>(VERSION <span class="hljs-number">2.8</span>)<br><br><span class="hljs-comment"># Declare the name of the CMake Project</span><br><span class="hljs-keyword">project</span>(modular_lib_pkg)<br><br><span class="hljs-comment"># Find Catkin</span><br><span class="hljs-keyword">find_package</span>(catkin REQUIRED)<br><span class="hljs-comment"># Declare this project as a catkin package</span><br>catkin_package()<br></code></pre></td></tr></table></figure><br>src/modular_lib_pkg/package.xml<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">package</span>&gt;</span><br>  <span class="hljs-comment">&lt;!-- Package Metadata --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>modular_lib_pkg<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">maintainer</span> <span class="hljs-attr">email</span>=<span class="hljs-string">&quot;you@example.com&quot;</span>&gt;</span>Your Name<span class="hljs-tag">&lt;/<span class="hljs-name">maintainer</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">description</span>&gt;</span><br>    A ROS tutorial on modularity.<br>  <span class="hljs-tag">&lt;/<span class="hljs-name">description</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">license</span>&gt;</span>BSD<span class="hljs-tag">&lt;/<span class="hljs-name">license</span>&gt;</span><br><br>  <span class="hljs-comment">&lt;!-- Required by Catkin --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">buildtool_depend</span>&gt;</span>catkin<span class="hljs-tag">&lt;/<span class="hljs-name">buildtool_depend</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">package</span>&gt;</span><br></code></pre></td></tr></table></figure></p>
<h2 id="Separating-Functionality-into-a-Library"><a href="#Separating-Functionality-into-a-Library" class="headerlink" title="Separating Functionality into a Library"></a>Separating Functionality into a Library</h2><p>&emsp;The first step in making code available for use in other ROS packages is to encapsulate its functionality into a library.</p>
<p>&emsp;On most operating systems, including Linux8, there are two types of libraries: static libraries and dynamic libraries. Both of these types of libraries contain compiled binary code which can be executed directly by a computer.</p>
<p>&emsp;Static libraries (.a for “archive” on Linux) are linked into an executable when it is built and it becomes part of that executable. When the executable is loaded, the binary code that was copied from the static library is also loaded. Dynamic libraries (.so for “shared object” on Linux), however, are not copied into the executable, and instead are loaded at runtime.</p>
<p>&emsp;This means not only are dynamically-linked executables smaller, but also the libraries that they depend on chan change internally without necessitating recompilation of the executable.</p>
<p>&emsp;In the ROS community, dynamic libraries are most commonly used, and this is what will be built by default when using Catkin.</p>
<h2 id="Create-the-Library-Code"><a href="#Create-the-Library-Code" class="headerlink" title="Create the Library Code"></a>Create the Library Code</h2><p>&emsp;The first step is to create the library. Our library will encapsulate the hello-world functionality used in the ROS C++ hello-world tutorial9 so that you can call a single function called say_hello() to broadcast “Hello, world!” over the /rosout topic.</p>
<p>&emsp;There’s nothing fundamentally different between putting C++ code in a library as opposed to an executable. What is required, however, is to split the code definition from the declaration. This involves creating two files: a header file and a source file.</p>
<p>&emsp;The header file should contain only what is needed by the compiler of anyone who uses the library. As such, it only needs to contain function and class delcarations, and does not need to contain function definitions.</p>
<p>&emsp;The header with the declaration of our say_hello() function is as follows:<br>modular_lib_pkg/include/modular_lib_pkg/hello_world.h<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// Inclusion guard to prevent this header from being included multiple times</span><br><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> __MODULAR_LIB_PKG_HELLO_WORLD_H</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> __MODULAR_LIB_PKG_HELLO_WORLD_H</span><br><br><span class="hljs-comment">//! Broadcast a hello-world message over ROS_INFO</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">say_hello</span><span class="hljs-params">()</span></span>;<br><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br></code></pre></td></tr></table></figure><br>Next is the source or implementation file. This file should contain what is needed by the linker to connect function calls to binary code. As such, it needs to contain all of the definitions of the functions declared in the corresponding header.<br>&emsp;The source file with the definition of say_hello() is as follows:<br>modular_lib_pkg/src/hello_world.cpp<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// Include the ROS C++ APIs</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;ros/ros.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">say_hello</span><span class="hljs-params">()</span> </span>&#123;<br>  <span class="hljs-built_in">ROS_INFO_STREAM</span>(<span class="hljs-string">&quot;Hello, world!&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><br>Now that we’ve written the code for the library, we can add a rule to the CMakeLists.txt file to actually build it. Note that just like in the ROS C++ hello-world tutorial9, we need to add a dependency on roscpp in order to use ROS. This is just like adding an executable with the add_executable() CMake command: instead, we use add_library():<br>src/modular_lib_pkg/CMakeLists.txt<br><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs cmake"><span class="hljs-comment"># Declare the version of the CMake API for forward-compatibility</span><br><span class="hljs-keyword">cmake_minimum_required</span>(VERSION <span class="hljs-number">2.8</span>)<br><br><span class="hljs-comment"># Declare the name of the CMake Project</span><br><span class="hljs-keyword">project</span>(modular_lib_pkg)<br><br><span class="hljs-comment"># Find and get all the information about the roscpp package</span><br><span class="hljs-keyword">find_package</span>(roscpp REQUIRED)<br><br><span class="hljs-comment"># Find Catkin</span><br><span class="hljs-keyword">find_package</span>(catkin REQUIRED)<br><span class="hljs-comment"># Declare this project as a catkin package</span><br>catkin_package()<br><br><span class="hljs-comment"># Add the headers from roscpp</span><br><span class="hljs-keyword">include_directories</span>(<span class="hljs-variable">$&#123;roscpp_INCLUDE_DIRS&#125;</span>)<br><br><span class="hljs-comment"># Define a library target called hello_world</span><br><span class="hljs-keyword">add_library</span>(hello_world src/hello_world.cpp)<br><span class="hljs-keyword">target_link_libraries</span>(hello_world <span class="hljs-variable">$&#123;roscpp_LIBRARIES&#125;</span>)<br></code></pre></td></tr></table></figure><br>&emsp;Also, now that we’re using the roscpp package, we need to list it as a build- and run-dependency of our package:<br>src/modular_lib_pkg/package.xml<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">package</span>&gt;</span><br>  <span class="hljs-comment">&lt;!-- Package Metadata --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>modular_lib_pkg<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">maintainer</span> <span class="hljs-attr">email</span>=<span class="hljs-string">&quot;you@example.com&quot;</span>&gt;</span>Your Name<span class="hljs-tag">&lt;/<span class="hljs-name">maintainer</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">description</span>&gt;</span><br>    A ROS tutorial on modularity.<br>  <span class="hljs-tag">&lt;/<span class="hljs-name">description</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">license</span>&gt;</span>BSD<span class="hljs-tag">&lt;/<span class="hljs-name">license</span>&gt;</span><br><br>  <span class="hljs-comment">&lt;!-- Required by Catkin --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">buildtool_depend</span>&gt;</span>catkin<span class="hljs-tag">&lt;/<span class="hljs-name">buildtool_depend</span>&gt;</span><br><br>  <span class="hljs-comment">&lt;!-- Package Dependencies --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">build_depend</span>&gt;</span>roscpp<span class="hljs-tag">&lt;/<span class="hljs-name">build_depend</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">run_depend</span>&gt;</span>roscpp<span class="hljs-tag">&lt;/<span class="hljs-name">run_depend</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">package</span>&gt;</span><br></code></pre></td></tr></table></figure><br>&emsp;At this point you should be able to compile the library by running catkin_make from the root of your workspace and see the following output:<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs gradle">Scanning <span class="hljs-keyword">dependencies</span> of target hello_world<br>[<span class="hljs-number">100</span>%] Building CXX object modular_lib_pkg<span class="hljs-regexp">/CMakeFiles/</span>hello_world.dir<span class="hljs-regexp">/src/</span>hello_world.cpp.o<br>Linking CXX shared library <span class="hljs-regexp">/tmp/</span>devel<span class="hljs-regexp">/lib/</span>libhello_world.so<br>[<span class="hljs-number">100</span>%] Built target hello_world<br></code></pre></td></tr></table></figure><br>&emsp;<strong>Notice</strong> that it built the hello_world target into a file called libhello_world.so. This is the standard naming convention for dynamic libraries on Linux. Also, it built the library into the lib subdirectory of the develspace, so when you source one of the setup files in the devel directory, it will make this library available for dynamic linking at runtime.</p>
<h2 id="Create-the-Node"><a href="#Create-the-Node" class="headerlink" title="Create the Node"></a>Create the Node</h2><p>&emsp;Now that we have our hello_world library, we can write a simple program to call the say_hello() function in that library. This program is nearly identical to the one used in the ROS C++ hello-world Tutorial9, except we replace the call to ROS_INFO with a call to say_hello() and we include the header file in the previous section.<br>modular_lib_pkg/src/hello_world_node.cpp<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// Include the ROS C++ APIs</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;ros/ros.h&gt;</span></span><br><br><span class="hljs-comment">// Include the declaration of our library function</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;modular_lib_pkg/hello_world.h&gt;</span></span><br><br><span class="hljs-comment">// Standard C++ entry point</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span>** argv)</span> </span>&#123;<br>  <span class="hljs-comment">// Initialize ROS</span><br>  ros::<span class="hljs-built_in">init</span>(argc, argv, <span class="hljs-string">&quot;hello_world_node&quot;</span>);<br>  ros::NodeHandle nh;<br><br>  <span class="hljs-comment">// Call our library function</span><br>  <span class="hljs-built_in">say_hello</span>();<br><br>  <span class="hljs-comment">// Wait for SIGINT/Ctrl-C</span><br>  ros::<span class="hljs-built_in">spin</span>();<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><br>To build this node, just add an appropriate add_executable() call to the bottom of the package’s CMakeLists.txt:<br><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">add<span class="hljs-constructor">_executable(<span class="hljs-params">hello_world_node</span> <span class="hljs-params">src</span><span class="hljs-operator">/</span><span class="hljs-params">hello_world_node</span>.<span class="hljs-params">cpp</span>)</span><br>target<span class="hljs-constructor">_link_libraries(<span class="hljs-params">hello_world_node</span> $&#123;<span class="hljs-params">roscpp_LIBRARIES</span>&#125;)</span><br></code></pre></td></tr></table></figure></p>
<h2 id="Building-the-Node-and-getting-a-compiler-error"><a href="#Building-the-Node-and-getting-a-compiler-error" class="headerlink" title="Building the Node (and getting a compiler error)"></a>Building the Node (and getting a compiler error)</h2><p>&emsp;At this point, you can try to build hello_world_node with catkin_make, but you will see the following error:<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs gradle">[<span class="hljs-number">100</span>%] Building CXX object modular_lib_pkg<span class="hljs-regexp">/CMakeFiles/</span>hello_world_node.dir<span class="hljs-regexp">/src/</span>hello_world_node.cpp.o<br><span class="hljs-regexp">/tmp/</span>src<span class="hljs-regexp">/modular_lib_pkg/</span>src<span class="hljs-regexp">/hello_world_node.cpp:5:42: fatal error: modular_lib_pkg/</span>hello_world.h: No such <span class="hljs-keyword">file</span> or directory<br>compilation terminated.<br></code></pre></td></tr></table></figure><br>&emsp;The compiler is complaining about modular_lib_pkg/hello_world.h not existing, but we know it exists! The problem isn’t that the file doesn’t exist, but rather that we haven’t told the compiler where to look for it.</p>
<p>&emsp;In the same way that we added the header search paths for roscpp, we also need to add our own local include directory where we put our own headers. To do so, just add the relative path to src/modular_lib_pkg/include to the existing include_directories() command in CMakeLists.txt:<br><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-keyword">include</span><span class="hljs-constructor">_directories(<span class="hljs-params">include</span> $&#123;<span class="hljs-params">roscpp_INCLUDE_DIRS</span>&#125;)</span><br></code></pre></td></tr></table></figure></p>
<h2 id="Building-the-Node-and-getting-a-linker-error"><a href="#Building-the-Node-and-getting-a-linker-error" class="headerlink" title="Building the Node (and getting a linker error)"></a>Building the Node (and getting a linker error)</h2><p>At this point, you can try to build hello_world_node with catkin_make again, but you will see another error:<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk">[<span class="hljs-number">100</span>%] Building CXX object modular_lib_pkg<span class="hljs-regexp">/CMakeFiles/</span>hello_world_node.dir<span class="hljs-regexp">/src/</span>hello_world_node.cpp.o<br>Linking CXX executable <span class="hljs-regexp">/tmp/</span>foo<span class="hljs-regexp">/devel/</span>lib<span class="hljs-regexp">/modular_lib_pkg/</span>hello_world_node<br>CMakeFiles<span class="hljs-regexp">/hello_world_node.dir/</span>src/hello_world_node.cpp.o:hello_world_node.cpp:<span class="hljs-keyword">function</span> main: error: undefined reference to <span class="hljs-string">&#x27;say_hello()&#x27;</span><br>collect2: ld returned <span class="hljs-number">1</span> <span class="hljs-keyword">exit</span> status<br></code></pre></td></tr></table></figure><br>&emsp;This time, hello_world_node.cpp is compiled successfully, but the linker reports an error that the say_hello() function is undefined. The declaration was found in the hello_world.h header file, otherwise it wouldn’t have compiled, still the definition from hello_world.cpp was missing.</p>
<p>&emsp;In order to resolve this, in addition to linking against ${roscpp_LIBRARIES}, we also link hello_world_node against the hello_world target so that its symbols are defined for the linker. This is done by adding hello_world to the existing target_link_libraries() command like the following:<br><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">target<span class="hljs-constructor">_link_libraries(<span class="hljs-params">hello_world_node</span> $&#123;<span class="hljs-params">roscpp_LIBRARIES</span>&#125; <span class="hljs-params">hello_world</span>)</span><br></code></pre></td></tr></table></figure><br>The following CMakeLists.txt file contains both this and the previous modifications:<br>src/modular_lib_pkg/CMakeLists.txt<br><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs cmake"><span class="hljs-comment"># Declare the version of the CMake API for forward-compatibility</span><br><span class="hljs-keyword">cmake_minimum_required</span>(VERSION <span class="hljs-number">2.8</span>)<br><br><span class="hljs-comment"># Declare the name of the CMake Project</span><br><span class="hljs-keyword">project</span>(modular_lib_pkg)<br><br><span class="hljs-comment"># Find and get all the information about the roscpp package</span><br><span class="hljs-keyword">find_package</span>(roscpp REQUIRED)<br><br><span class="hljs-comment"># Find Catkin</span><br><span class="hljs-keyword">find_package</span>(catkin REQUIRED)<br><span class="hljs-comment"># Declare this project as a catkin package</span><br>catkin_package()<br><br><span class="hljs-comment"># Add the local headers and the headers from roscpp</span><br><span class="hljs-keyword">include_directories</span>(<span class="hljs-keyword">include</span> <span class="hljs-variable">$&#123;roscpp_INCLUDE_DIRS&#125;</span>)<br><br><span class="hljs-comment"># Define a library target called hello_world</span><br><span class="hljs-keyword">add_library</span>(hello_world src/hello_world.cpp)<br><span class="hljs-keyword">target_link_libraries</span>(hello_world <span class="hljs-variable">$&#123;roscpp_LIBRARIES&#125;</span>)<br><br><span class="hljs-comment"># Define an executable target called hello_world_node</span><br><span class="hljs-keyword">add_executable</span>(hello_world_node src/hello_world_node.cpp)<br><span class="hljs-keyword">target_link_libraries</span>(hello_world_node <span class="hljs-variable">$&#123;roscpp_LIBRARIES&#125;</span> hello_world)<br></code></pre></td></tr></table></figure></p>
<h2 id="Building-the-Node-and-succeeding"><a href="#Building-the-Node-and-succeeding" class="headerlink" title="Building the Node (and succeeding)"></a>Building the Node (and succeeding)</h2><p>Now you should be able to compile hello_world_node succesfully and then (assuming you sourced one of your workspace’s setup files) you can run it with rosrun:<br><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">rosrun modular_lib_pkg hello_world_node</span><br></code></pre></td></tr></table></figure><br>This node does the same thing as before, except now, the core functionality is implemented in a separate library, which could more easily be used by other packages.</p>
<h1 id="Using-Libraries-from-Other-Packages"><a href="#Using-Libraries-from-Other-Packages" class="headerlink" title="Using Libraries from Other Packages"></a>Using Libraries from Other Packages</h1><p>Now that we’ve created a single package with its functionality built into a library, we can create another package which also uses that functionality. In this case, we’ll create another hello_world_node in another package which also links against libhello_world.so from modular_lib_pkg.</p>
<h2 id="Create-the-Second-Package-and-Node"><a href="#Create-the-Second-Package-and-Node" class="headerlink" title="Create the Second Package and Node"></a>Create the Second Package and Node</h2><p>First, create a package for the new node called modular_node_pkg:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> src/modular_node_pkg<br></code></pre></td></tr></table></figure><br>Next, add the source code for our node. This code is exactly the same as the hello_world_node.cpp in the modular_lib_pkg:<br>modular_node_pkg/hello_world_node.cpp<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// Include the ROS C++ APIs</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;ros/ros.h&gt;</span></span><br><br><span class="hljs-comment">// Include the declaration of our library function</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;modular_lib_pkg/hello_world.h&gt;</span></span><br><br><span class="hljs-comment">// Standard C++ entry point</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span>** argv)</span> </span>&#123;<br>  <span class="hljs-comment">// Initialize ROS</span><br>  ros::<span class="hljs-built_in">init</span>(argc, argv, <span class="hljs-string">&quot;hello_world_node&quot;</span>);<br>  ros::NodeHandle nh;<br><br>  <span class="hljs-comment">// Call our library function</span><br>  <span class="hljs-built_in">say_hello</span>();<br><br>  <span class="hljs-comment">// Wait for SIGINT/Ctrl-C</span><br>  ros::<span class="hljs-built_in">spin</span>();<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><br>Then add the following CMakeLists.txt and package.xml files to the new package. Note that now that we’re using the modular_lib_pkg just like we’re using the roscpp package, we need to find its headers and libraries just like we do with roscpp:<br>src/modular_node_pkg/CMakeLists.txt<br><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs cmake"><span class="hljs-comment"># Declare the version of the CMake API for forward-compatibility</span><br><span class="hljs-keyword">cmake_minimum_required</span>(VERSION <span class="hljs-number">2.8</span>)<br><br><span class="hljs-comment"># Declare the name of the CMake Project</span><br><span class="hljs-keyword">project</span>(modular_node_pkg)<br><br><span class="hljs-comment"># Find and get all the information about the roscpp package</span><br><span class="hljs-keyword">find_package</span>(roscpp REQUIRED)<br><br><span class="hljs-comment"># Find and get all the information about the modular_lib_pkg package</span><br><span class="hljs-keyword">find_package</span>(modular_lib_pkg REQUIRED)<br><br><span class="hljs-comment"># Find Catkin</span><br><span class="hljs-keyword">find_package</span>(catkin REQUIRED)<br><span class="hljs-comment"># Declare this project as a catkin package</span><br>catkin_package()<br><br><span class="hljs-comment"># Add the headers from roscpp</span><br><span class="hljs-keyword">include_directories</span>(<span class="hljs-variable">$&#123;roscpp_INCLUDE_DIRS&#125;</span> <span class="hljs-variable">$&#123;modular_lib_pkg_INCLUDE_DIRS&#125;</span>)<br><br><span class="hljs-comment"># Define an executable  target called hello_world_node</span><br><span class="hljs-keyword">add_executable</span>(hello_world_node2 hello_world_node.cpp)<br><span class="hljs-keyword">target_link_libraries</span>(hello_world_node2 <span class="hljs-variable">$&#123;roscpp_LIBRARIES&#125;</span> <span class="hljs-variable">$&#123;modular_lib_pkg_LIBRARIES&#125;</span>)<br></code></pre></td></tr></table></figure><br><strong>NOTE:</strong> Goofy or not, the way that Catkin works, it combines all of your packages into a single CMake project. This means that each package must have unique target names. Otherwise the world will implode and unhappiness will descend upon the land. If you don’t want to have this constraint, you can use catkin_make_isolated which will build each package in isolation, but will be slower.<br>src/modular_lib_pkg/package.xml<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">package</span>&gt;</span><br>  <span class="hljs-comment">&lt;!-- Package Metadata --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>modular_node_pkg<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">maintainer</span> <span class="hljs-attr">email</span>=<span class="hljs-string">&quot;you@example.com&quot;</span>&gt;</span>Your Name<span class="hljs-tag">&lt;/<span class="hljs-name">maintainer</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">description</span>&gt;</span><br>    A ROS tutorial on modularity.<br>  <span class="hljs-tag">&lt;/<span class="hljs-name">description</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">license</span>&gt;</span>BSD<span class="hljs-tag">&lt;/<span class="hljs-name">license</span>&gt;</span><br><br>  <span class="hljs-comment">&lt;!-- Required by Catkin --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">buildtool_depend</span>&gt;</span>catkin<span class="hljs-tag">&lt;/<span class="hljs-name">buildtool_depend</span>&gt;</span><br><br>  <span class="hljs-comment">&lt;!-- Package Dependencies --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">build_depend</span>&gt;</span>roscpp<span class="hljs-tag">&lt;/<span class="hljs-name">build_depend</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">build_depend</span>&gt;</span>modular_lib_pkg<span class="hljs-tag">&lt;/<span class="hljs-name">build_depend</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">run_depend</span>&gt;</span>roscpp<span class="hljs-tag">&lt;/<span class="hljs-name">run_depend</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">run_depend</span>&gt;</span>modular_lib_pkg<span class="hljs-tag">&lt;/<span class="hljs-name">run_depend</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">package</span>&gt;</span><br></code></pre></td></tr></table></figure><br>After creating these files, your workspace should look like the following:<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs stylus">.<br>├── build<br>│   └── ...<br>├── devel<br>│   └── ...<br>└── <span class="hljs-attribute">src</span><br>    ├── CMakeLists<span class="hljs-selector-class">.txt</span> -&gt; /opt/ros/hydro/share/catkin/cmake/toplevel<span class="hljs-selector-class">.cmake</span><br>    ├── modular_lib_pkg<br>    │   ├── CMakeLists<span class="hljs-selector-class">.txt</span><br>    │   ├── include<br>    │   │   └── modular_lib_pkg<br>    │   │       └── hello_world<span class="hljs-selector-class">.h</span><br>    │   ├── package<span class="hljs-selector-class">.xml</span><br>    │   └── <span class="hljs-attribute">src</span><br>    │       ├── hello_world<span class="hljs-selector-class">.cpp</span><br>    │       └── hello_world_node<span class="hljs-selector-class">.cpp</span><br>    └── modular_node_pkg<br>        ├── CMakeLists<span class="hljs-selector-class">.txt</span><br>        ├── hello_world_node<span class="hljs-selector-class">.cpp</span><br>        └── package.xml<br></code></pre></td></tr></table></figure></p>
<h2 id="Building-the-Node-and-getting-a-compiler-error-again"><a href="#Building-the-Node-and-getting-a-compiler-error-again" class="headerlink" title="Building the Node (and getting a compiler error again)"></a>Building the Node (and getting a compiler error again)</h2><p>If you try to build yor workspace by running catkin_make at this point, you will get the same compiler error as before, but this time with the new node!<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs gradle">[<span class="hljs-number">100</span>%] Building CXX object modular_node_pkg<span class="hljs-regexp">/CMakeFiles/</span>hello_world_node2.dir/hello_world_node.cpp.o<br><span class="hljs-regexp">/tmp/</span>foo<span class="hljs-regexp">/src/m</span>odular_node_pkg<span class="hljs-regexp">/hello_world_node.cpp:5:41: fatal error: modular_lib_pkg/</span>hello_world.h: No such <span class="hljs-keyword">file</span> or directory<br>compilation terminated.<br></code></pre></td></tr></table></figure><br>Despite the fact that you included ${modular_lib_pkg_INCLUDE_DIRS} in the include_directories() CMake function, it still couldn’t find the header. This is because this sort of information needs to be exported by the other package.</p>
<p>With the current workspace, not only will ${modular_lib_pkg_INCLUDE_DIRS} be empty, but also ${modular_lib_pkg_LIBRARIES} will also be empty.</p>
<h2 id="Exporting-Package-Flags-to-Other-Packages"><a href="#Exporting-Package-Flags-to-Other-Packages" class="headerlink" title="Exporting Package Flags to Other Packages"></a>Exporting Package Flags to Other Packages</h2><p>In the previous secion, our second package, modular_node_pkg, was unable to get the compilation or linker flags from the first package, modular_lib_pkg. This is because the flags weren’t exported by modular_lib_pkg. With Catkin, exporting such information is done with the catkin_package() command in the CMakeLists.txt file, and in the case of modular_lib_pkg, we didn’t pass it any arguments:<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">catkin_package</span><span class="hljs-params">()</span></span><br></code></pre></td></tr></table></figure><br>This function can be left empty if we don’t need to export anything, but if we do, there are several optional arguments10 and the following are most commonly used:</p>
<ul>
<li>INCLUDE_DIRS One or more header directories that should be made available to other packages. These directories are relative to the path of the given CMakeLists.txt file.</li>
<li>LIBRARIES One or more libraries that should be made available to other packages. These are the target names of the libraries.</li>
<li>CATKIN_DEPENDS One or more names of Catkin packages whose build flags should be passed transitively to any package which depends on this one. This will cause dependent packages to automatically call find_package() on each of these names.</li>
<li>DEPENDS One or more names of packages whose build flags should be passed transitively to any package which depends on this one. If a name like foo is given here, then Catkin will add whatever the contents of the ${foo_INCLUDE_DIRS} and ${foo_LIBRARIES} variables will be exported as part of this package’s include directories and libraries, respectively.<br>In our case, we want to export both a local include directory and a library, so we modify the catkin_package() call in the modular_lib_pkg CMakeLists.txt to export the flags for our include directory and library.</li>
</ul>
<p>Additionally, we should declare that anyone depending on this package should also use build flags from the roscpp package. This is important either if we link our library against libraries from the roscpp package or if any of our exported header files #include headers from roscpp.<br><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs isbl"><span class="hljs-function"><span class="hljs-title">catkin_package</span>(</span><br><span class="hljs-function">  <span class="hljs-variable">INCLUDE_DIRS</span> <span class="hljs-variable">include</span></span><br><span class="hljs-function">  <span class="hljs-variable">LIBRARIES</span> <span class="hljs-variable">hello_world</span></span><br><span class="hljs-function">  <span class="hljs-variable">CATKIN_DEPENDS</span> <span class="hljs-variable">roscpp</span></span><br><span class="hljs-function">  )</span><br></code></pre></td></tr></table></figure><br><strong>NOTE:</strong> In this specific case, leaving out the CATKIN_DEPENDS on roscpp won’t cause any problems, but this is only because it is unlikely that someone would try to build a ROS C++ node without depending on roscpp directly. A motivating example will be shown in the next section.<br>The complete CMakeLists.txt for modular_lib_pkg is as follows:<br>src/modular_lib_pkg/CMakeLists.txt<br><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs cmake"><span class="hljs-comment"># Declare the version of the CMake API for forward-compatibility</span><br><span class="hljs-keyword">cmake_minimum_required</span>(VERSION <span class="hljs-number">2.8</span>)<br><br><span class="hljs-comment"># Declare the name of the CMake Project</span><br><span class="hljs-keyword">project</span>(modular_lib_pkg)<br><br><span class="hljs-comment"># Find and get all the information about the roscpp package</span><br><span class="hljs-keyword">find_package</span>(roscpp REQUIRED)<br><br><span class="hljs-comment"># Find Catkin</span><br><span class="hljs-keyword">find_package</span>(catkin REQUIRED)<br><span class="hljs-comment"># Declare this project as a catkin package and export the necessary build flags</span><br>catkin_package(<br>  INCLUDE_DIRS <span class="hljs-keyword">include</span><br>  LIBRARIES hello_world<br>  CATKIN_DEPENDS roscpp<br>  )<br><br><span class="hljs-comment"># Add the local headers and the headers from roscpp</span><br><span class="hljs-keyword">include_directories</span>(<span class="hljs-keyword">include</span> <span class="hljs-variable">$&#123;roscpp_INCLUDE_DIRS&#125;</span>)<br><br><span class="hljs-comment"># Define a library target called hello_world</span><br><span class="hljs-keyword">add_library</span>(hello_world src/hello_world.cpp)<br><span class="hljs-keyword">target_link_libraries</span>(hello_world <span class="hljs-variable">$&#123;roscpp_LIBRARIES&#125;</span>)<br><br><span class="hljs-comment"># Define an executable target called hello_world_node</span><br><span class="hljs-keyword">add_executable</span>(hello_world_node src/hello_world_node.cpp)<br><span class="hljs-keyword">target_link_libraries</span>(hello_world_node <span class="hljs-variable">$&#123;roscpp_LIBRARIES&#125;</span> hello_world)<br></code></pre></td></tr></table></figure><br>You can now build the workspace again with catkin_make, but this time it should succeed:<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs awk">[ <span class="hljs-number">33</span>%] Building CXX object modular_lib_pkg<span class="hljs-regexp">/CMakeFiles/</span>hello_world.dir<span class="hljs-regexp">/src/</span>hello_world.cpp.o<br>Linking CXX shared library <span class="hljs-regexp">/tmp/</span>devel<span class="hljs-regexp">/lib/</span>libhello_world.so<br>[ <span class="hljs-number">33</span>%] Built target hello_world<br>[ <span class="hljs-number">66</span>%] Building CXX object modular_lib_pkg<span class="hljs-regexp">/CMakeFiles/</span>hello_world_node.dir<span class="hljs-regexp">/src/</span>hello_world_node.cpp.o<br>Linking CXX executable <span class="hljs-regexp">/tmp/</span>devel<span class="hljs-regexp">/lib/m</span>odular_lib_pkg/hello_world_node<br>[ <span class="hljs-number">66</span>%] Built target hello_world_node<br>[<span class="hljs-number">100</span>%] Building CXX object modular_node_pkg<span class="hljs-regexp">/CMakeFiles/</span>hello_world_node2.dir/hello_world_node.cpp.o<br>Linking CXX executable <span class="hljs-regexp">/tmp/</span>devel<span class="hljs-regexp">/lib/m</span>odular_node_pkg/hello_world_node2<br>[<span class="hljs-number">100</span>%] Built target hello_world_node2<br></code></pre></td></tr></table></figure><br>And finally, (assuming you still have your workspace environment set up), you can run hello_world_node2:<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">rosrun</span> modular_node_pkg hello_world_node2<br></code></pre></td></tr></table></figure><br>Reference:<br><a target="_blank" rel="noopener" href="https://jbohren.com/articles/modular-ros-packages">original article</a></p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/slam/" class="category-chain-item">slam</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E8%BD%AC%E8%BD%BD/">#转载</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Building Modular ROS Packages</div>
      <div>https://qiangsun89.github.io/2023/03/10/Building-Modular-ROS-Packages/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Qiang Sun</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2023年3月10日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2023/03/14/How-to-read-a-research-paper/" title="How to read a research paper">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">How to read a research paper</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/03/08/Why-does-my-robot-navigate-too-close-to-walls-and-or-cuts-corners/" title="Why does my robot navigate too close to walls and/or cuts corners?">
                        <span class="hidden-mobile">Why does my robot navigate too close to walls and/or cuts corners?</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/valine/1.5.1/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"LEYjQzDk7jo8uqlOQoAEF5qm-gzGzoHsz","appKey":"7bBCyINnLw0akaPjI39pESMN","path":"window.location.pathname","placeholder":"留言","avatar":"retro","meta":["nick","mail","link"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":false,"serverURLs":"","emojiCDN":null,"emojiMaps":null,"enableQQ":false},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          var imgSelector = '#valine .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="leancloud-site-pv-container" style="display: none">
        总访问量 
        <span id="leancloud-site-pv"></span>
         次
      </span>
    
    
      <span id="leancloud-site-uv-container" style="display: none">
        总访客数 
        <span id="leancloud-site-uv"></span>
         人
      </span>
    
    

  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script defer src="/js/leancloud.js" ></script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<!-- <script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> -->
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>
